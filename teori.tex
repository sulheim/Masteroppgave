|%Teori.tex
\section{Theory}
\subsection{Ultrasound theory}
Ultrasound is sound waves with frequency above \SI{20}{\kilo\hertz}, which is the upper limit of audible sound. For the purpose of medical imaging, frequencies of \SIrange{2}{15}{\mega\hertz} are common\cite{Hoskins2010}. Ultrasound is a tool used daily in hospitals to image parts of the body. Like other medical imaging modalities - MR, CT, X-ray - energy is applied and while the energy travels through the body interactions occur. The image is then produced by measuring some aspect of the energy after the interactions. The image can successfully be created from knowledge of the energy before and after interaction, and from an understanding of the interaction mechanisms.

Ultrasound is generated by a transducer, and as the wave travels through the body, echoes are generated by partial reflection at every boundary. The amount of reflection depends on the relative change in acoustic impedance at the boundary. The echo is recorded by the transducer, and it is then displayed in the image according to its spatial origin. The speed of sound is approximately \SI{1540}{\metre\per\second} for all soft body tissue, and it is thus possible to calculate the origin by measuring the time of travel of the echo\cite{Flower2012}. 

The next sections review the major interactions of ultrasound with tissue; reflection, absorption and scattering. Then follows an overview of the interactions between ultrasound and microbubbles. The microbubbles interact strongly, and in a non-linear fashion even at moderate energies used for imaging.

\subsubsection{Imaging modalities}
Ultrasound images can be captured using several different modalities to enhance different properties of the tissue. The simplest modality is the amplitude-mode (A-mode), where a single element transducer is used to generate echoes along one line, and the received echoes are plotted as a function of depth. Brightness-mode (B-mode) use an array of transducers to generate a 2D (3D) map of a slice (volume) through the body, where the image brightness is proportional to the echo originated from the corresponding location. Motion mode (M-mode) is generated from a sequence of A- or B-mode images to image tissue motion. Doppler imaging is another large field of imaging modes, where the Doppler effect is utilized to image the blood flow. This can be used to measure the velocity, direction and total blood flow. Non-linear imaging is another field of imaging modes used to enhance the visibility of contrast agents. This is described in more detail in Section \ref{sec:contrast_img}.

\subsubsection{Ultrasound wave propagation}
Sound is pressure waves, and the pressure fluctuations cause temporal displacement of the medium in which the wave is travelling. For most imaging purposes the displacement is along the direction of travel, this is know as longitudinal waves. Solids can support transverse sound waves, but that is outside the scope of this thesis.  The wavelength, $\lambda$, is determined by the frequency of the source and the phase velocity in the medium, $c$, i.e. $\lambda= \frac{c}{f}$. The phase velocity $c$ is given by

\begin{equation}
\label{phace velocity}
c = \sqrt{\frac{1}{\rho \kappa}},
\end{equation}

where $\rho$ and $\kappa$ are the tissue density and compressibility, respectively.% For soft human tissue the phase velocity is about \SI{1540}{\metre\per\second}.%, while it is about \SI{4000}{\metre\per\second} for bone.
The compressibility is a measure of the relative change in volume from change in pressure, that is $\kappa = -\frac{1}{V}\frac{\partial V}{\partial p}$. Here $V$ is volume and $p$ is pressure. 

The propagation of a sound wave travelling in the x-direction can in a fluid be described by the wave equation, i.e.
\begin{equation}
\label{wave equation}
\frac{\partial^2W}{\partial x^2} = \frac{\rho_0}{G}\frac{\partial^2W}{\partial t^2}.
\end{equation}

Here $W$ is the particle displacement, $\rho_0$ the density of the medium and $G$ the bulk modulus\cite{Flower2012}. The bulk modulus is the reciprocal of the compressibility, and is a measure of the volume stiffness. A general solution to this equation is 
\begin{equation}
\label{particle displacement}
W = W_0 \exp^{i(kx - \omega t)},
\end{equation}

where $\omega$ is the angular frequency, $k = \frac{\omega}{c}$ the wave number, and $c$ the phase velocity as given in Equation \eqref{phace velocity}, with $\kappa$ substituted by $\frac{1}{G}$. The pressure variations is then given by particle velocity $u_x = \frac{\partial W}{\partial t}$ as 

\begin{equation}
\label{pressure wave}
p_x = \rho_0 c u_x.
\end{equation}

It is important to emphasize the difference between the phase velocity and the particle velocity. The phase velocity is the velocity of energy carried through the medium, while the particle velocity is the velocity of the local displacement of particles.

The acoustic impedance $Z$ of the medium is defined as the ratio between the excess pressure and the particle velocity,
\begin{equation}
\label{acoustic impedance}
 Z = \frac{p}{u}.
\end{equation}
 
Here $u = \vec{u}\times \vec{n}$ is a speed obtained from the real particle velocity $\vec{u}$ and the unit vector $\vec{n}$ of the direction of propagation. If we consider a forward travelling, plane wave the equation reduces to 
\begin{equation}
p = \rho c = \sqrt{\frac{\rho}{K}},
\end{equation}
 where $\rho$ is the density and $K$ the compressibility\cite{Healey2012}. This is known as the characteristic acoustic impedance.
\subsubsection{Reflection}
Reflection provide the basis for ultrasound imaging, and occurs when the wave encounter a planar surface with a change in acoustic impedance. Across this surface both the pressure and particle velocity have to be continuous. From these boundary conditions 
%The acoustic impedance $z$ is given by  
%\begin{equation}
%z = \rho c.
%\end{equation}
the intensity coefficients of the reflected wave, $r_i$, and transmitted wave, $t_i$, can be given as \cite{wells1969physical}
\begin{equation}
\label{fresnel}
r_i = \left(\frac{z_2 \cos \theta_i - z_1 \cos \theta_t}{z_1 \cos \theta_t + z_2 \cos \theta_i}\right)^2
\end{equation}

\begin{equation}
\label{fresnel2}
t_i = \frac{4z_2 z_1 \cos^2 \theta_i}{(z_2 \cos \theta_i + z_1 \cos \theta_t)^2}.
\end{equation}

Here $z_1$ and $z_2$ are the acoustic impedance in medium 1 and 2(Figure \ref{Fig:fresnel}). The angle of reflection $\theta_r$ is equal the angle of incidence $\theta_i$, while the angle of transmission $\theta_t$ is given by Snell's law\cite{blackstock2000fundamentals}, $ c_2 \sin \theta_i = c_1 \sin \theta_t$. 

\begin{figure}[h]
	\centering
	\includegraphics[width=\linewidth]{fresnel.png}
	\caption{Reflection (r) and transmission (t) of an incoming pressure wave at an interface between two tissues with acoustic impedance $z_1$ and $z_2$.}
	\label{Fig:fresnel}
\end{figure} 

\subsubsection{Absorption}
Loss of kinetic energy to heat from the propagating wave to the surrounding medium is known as absorption. Absorption occurs continuously and reduces the amplitude of the wave. For linear propagation of a pressure wave, this can be described as 

\begin{equation}
p(x) = p(0)\exp^{-\alpha_A(\omega)x},
\end{equation} 

where $p(0)$ is the initial pressure amplitude, $\alpha_A$ the absorption coefficient and $\omega$ the angular frequency.

For non-linear propagation the absorption depends on the local amplitude. In the diagnostic intensity range the non-linear interaction is proportional to the square of the intensity\cite{church1995}. Non-linear propagation also affects the shape and frequency spectrum of the propagating wave, and can usually not be ignored for contrast agent applications\cite{Healey2012}. 

%\subsubsection{Non-linear imaging??}
 
\subsubsection{Scattering}
Scattering is reflection that occurs when the size $d$ of the surface encountered is comparable to or smaller than the wavelength. Scattering can arise from inhomogenities in compressibility, density or absorption. Scattering reflects the wave in a large range of directions, and the backscattered signal received at the transducer is therefore weak compared to reflected echoes. The magnitude and direction of the scattering depends on the size of the scatterer and increase strongly with the frequency.  

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{scattering2.png}
  \caption{The scattered wave $p_s$ due to incident pressure wave $p_i$ and scatterer at $\textbf{r}_0$.} 
  \label{Fig:Scattering}
\end{figure}
If we consider an incoming plane wave propagating in the direction $\hat{i}$ (Figure \ref{Fig:Scattering}), the incident pressure, $p_i$, at the scatterer located at $\textbf{r}_0$ is then

\begin{equation}
p_i(\textbf{r}_0, t) = p_0\exp^{i(\textbf{r}_0\textbf{k}_i-\omega t)}.
\end{equation}

If we only consider the far field, the scattered wave, $p_s$, at the observer at $\textbf{r}$ is given by \cite{Healey2012}

\begin{equation}
p_s(\textbf{r}, t) = f(\hat{r},\hat{i})\frac{\exp^{ik_s(\textbf{r}-\textbf{r}_0}}{\abs{\textbf{r}-\textbf{r}_0}}p_i(\textbf{r}_0, t).
\end{equation}

The $f(\hat{r},\hat{i})$ is the scattering amplitude function. The scattered intensity is

\begin{equation}
I_s = \frac{1}{2}\frac{\abs{p_s}^2}{\rho c} =\frac{1}{2}\frac{\abs{p_i}^2}{\rho c}\frac{\abs{f(\hat{r},\hat{i})^2}}{\abs{\textbf{r}-\textbf{r}_0}^2} = I_i \frac{\abs{f(\hat{r},\hat{i})}^2}{\abs{\textbf{r}-\textbf{r}_0}^2},
\end{equation}

where $I_i$ is the incident intensity. The differential scattering cross-section is defined as $\sigma_d = |f(\hat{r},\hat{i})|^2$. The scattering cross section is the integral of the differential cross section over all solid angles, i.e.

\begin{equation}
\label{solid angle}
\sigma_s = \int_{4\pi}\sigma_d \mathrm{d}\Omega.
\end{equation}

The Rayleigh scattering model is the simplest model for scattering of small particles, i.e. particles with a diameter $d << \lambda$. This model does not take damping or resonance effects into account. If we again consider the plane wave, the differential scattering cross section is given by\cite{Morse1968}

\begin{equation}
\label{rayleigh cross section}
\sigma_d = k^4a^6\left[\frac{G-G_0}{3G}-\frac{\rho-\rho_0}{2\rho+\rho_0}\cos\theta\right]^2.
\end{equation} 

The total cross-section is obtained using Equation \ref{solid angle} and \ref{rayleigh cross section},

\begin{equation}
\label{total cross-section}
\sigma_s = 4\pi k^4 a^6 \left[\left(\frac{G-G_0}{3G}\right)^2 +\frac{1}{3}\left(\frac{\rho-\rho_0}{2\rho + \rho_0}\right)^2\right].
\end{equation}
In these equations $k$ is the wavenumber, $a$ the radius of the scatterer, and the zero subscript refers to properties of the surrounding medium. The angle $\theta$ is the angle between the incident wave and the scattered wave, i.e. $\theta = \ang{180}$ is the direction of backscattering. Although these equations represent a coarse approximation, it demonstrates why gas bubbles are excellent contrast agents. The density term in Equation \eqref{total cross-section} is limited to $\nicefrac{1}{3}$, while the bulk modulus term has no upper limit as $G$ gets small compared to $G_0$. Thus, it is the compressibility and not the acoustic impedance which is the main cause of the scattering off a gas bubble. This is shown in Figure \ref{Fig:rayleigh}.

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{rayleigh_scatter.png}
  \caption{Contribution to Rayleigh scattering cross section from relative bulk modulus and relative density\cite{Hoff2000}. Note the logarithmic scaling on both axis.}
  \label{Fig:rayleigh}
\end{figure} 

It is important to keep in mind that the compressibility term in Equation \ref{rayleigh cross section} is a monopole, so for gas based microbubbles monopole scattering will dominate. In a solid medium, such as steel, with low compressibility and high density, the scattering is dominated by the dipole term. Differential scattering cross sections for spheres of steel and air is plotted in Figure \ref{fig:diff cross_sec}.
\begin{figure}[h]
	\centering
	    \begin{minipage}[b]{0.3\textwidth}
			\includegraphics[width=\textwidth]{steel_bubble3_cross_section.png}
			    \caption{A}
                \label{fig:diff cross sec_steel}
		\end{minipage}%
    	\begin{minipage}[b]{0.3\textwidth}
			\includegraphics[width=\textwidth]{diff_cross_sec_3.png}
			    \caption{B}
                \label{fig:diff cross sec_air}
		\end{minipage}%
		\begin{minipage}[b]{0.3\textwidth}
			\includegraphics[width=\textwidth]{diff_cross_sec_30.png}
			    \caption{C}
                \label{fig:diff cross sec air_30}
		\end{minipage}%		
		
  \caption{Differential cross section for a \SI{3}{\micro\meter} sphere of steel(A) and air(B), and for a \SI{30}{\micro\meter} sphere of air(C)\cite{Healey2012}. The dipole term dominates in A while the monopole term dominates in B. In C there is more of a balance between the monopole and dipole term.}
  \label{fig:diff cross_sec}
\end{figure} 


%Include table from andys Ultrasound paper?
%Include figures os differntial cross-sections?


\subsubsection{The bubble as a linear oscillator}
This section follows the derivation of the bubble as a linear oscillator by \citet{Hoff2000}, which contains a full review of subject: acoustic properties of contrast agents. To include the effects of damping and resonance, the microbubble can be modelled as a harmonic oscillator. Comparing the bubble with a mass/spring system (Figure \ref{Fig:oscillator}), the gas pressure, surrounding liquid and radiation resistance corresponds to the spring, mass and dash-pot, respectively. The limitation for linear oscillations is that the radial displacement of the bubble wall is small compared to the bubble radii. 

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{oscillator.png}
  \caption{The bubble as a harmonic oscillator, in comparison to the mass/spring system\cite{Hoff2000}.}
  \label{Fig:oscillator}
\end{figure} 

As the bubble oscillates both the gas inside and the liquid outside the bubble add inertia to the system. Due to the relative low density of the gas, this contribution can be neglected. The gas inside the bubble acts against any volume change of the bubble, thus acting as the spring in the system. The damping of the system is caused by heat transport to the surroundings, radiation of sound and by the viscosity of the liquid. If we consider a bubble with a shell, viscous forces in the shell contribute to the damping. 

%The equation of motion is obtained from the forces acting on the bubble surface, 
%
%\begin{equation}
%\label{eq:motion}
%F_m + F_s + F_R = \int \int_S p_i(t) \dif S,
%\end{equation}
%where$p_i(t)$ is the driving acoustic pressure, and the forces are given as
%
%\begin{equation}
%\label{eq:forces}
%F_m = - (R\dot{\epsilon} + m\ddot{\epsilon}), \quad F_s = -s\epsilon \mathrm{ and } F_R = 
%\end{equation}
%%%Include this???

For this system the resonance frequency $f_0$ is given as \cite{Hoff2000}
\begin{equation}
\label{resonance}
f_0 = \frac{\omega}{2 \pi}= \frac{1}{2 \pi a} \sqrt{\frac{3\kappa p_0}{\rho}+ \frac{12 G_s d_s}{a}}.
\end{equation} 

Here $a$ is the bubble radius, $G_s$ and $d_s$ the shear modulus and thickness of the shell, $p_0$ the atmospheric pressure and $\kappa$ the polytropic exponent of the gas. The polytropic exponent is equal to the adiabatic constant $\gamma$ when the oscillations are adiabatic, while it is 1 for isothermal conditions. This depends on the bubble radius and signal frequency\cite{Hoff2000}. The second term on the right-hand side of Equation \eqref{resonance} is the contribution from the shell to the bulk modulus of the system. 

The scattering cross section is 
\begin{equation}
\label{eq:cross section}
\sigma_S = 4\pi a^2 \frac{\Omega^4}{(1-\Omega^2)^2 + (\Omega \delta)^2}, 
\end{equation}

where $\Omega = \nicefrac{\omega}{\omega_0}$ and $\delta$ the damping constant of the system. The scattering cross section for air and Sonazoid\texttrademark microbubbles is plotted in Figure \ref{Fig:cross_sections} and \ref{Fig:cross sections 60}. We observe that the presence of a shell increase the resonance frequency and broadens the resonance peak\cite{Healey2012}. There is also a difference in acoustic response for large and small bubbles at low frequencies. This allows imaging of the large ACT\texttrademark bubbles at lower frequencies and with fundamental B-mode. The resonance frequency is reduced for increased bubble size.
 
\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{cross_sections.png}
  \caption{Left: Log-log plot of the scattering cross section $\sigma_S$ for air bubbles with diameter \num{1}, \num{3} and \SI{8}{\micro\meter}. Right: Corresponding plot of Sonazoid\texttrademark bubbles\cite{Healey2012}.}
  \label{Fig:cross_sections}
\end{figure} 

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{large_bubbles_cross_section.png}
  \caption{Log-log plot of the scattering cross section $\sigma$ for air bubbles with diameter \num{20}, \num{30} and \SI{40}{\micro\meter}\cite{Healey2012}. }
  \label{Fig:cross sections 60}
\end{figure} 
   
%%Model limitations?
\subsubsection{Non-linear behaviour}
Until now we have only considered the linear behaviour for both the wave propagation and the bubble scattering and oscillation. A brief review of non-linear wave propagation will be followed by a section on the bubble as a non-linear oscillator. A full review of these subjects are found in previous work by \citet{Uck2002} and \citet{Hoff2000}.

When the amplitude of the acoustic wave exceeds about \SI{1}{\mega\pascal}, non-linear propagation become noticeable\cite{Uck2002}. Non-linear effects can be divided into local and cumulative. Local effects are displacement of vibrating sources, and differences in the relationship between pressure and particle velocity. Local effects are regarded as negligible, except for oscillating microbubbles where there is a change in the pressure/bubble radius relationship\cite{Uck2002}. 

Cumulative effects are caused by differences in the propagation speed at different locations in the wave. At the peak pressure the tissue will be compressed, increasing the speed of sound. In the region of rarefaction the propagation speed is decreased.  This causes distortion of the waveform which will develop with distance (Figure \ref{Fig:non_lin_prop}). The compression peak will move in the direction of propagation, while the rarefaction peak moves in the opposite direction. This will decrease the distance between the two peaks, until they are coincident and we get a discontinuity of the wave.  

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{non_linear_prop.png}
  \caption{The measured focal waveform of a \SI{3}{\mega\hertz} Doppler pulse in water for low acoustic pressure (a) and a pulse where the pressure is increased by 24 dB. The distortion of the waveform is easily seen in b\cite{Uck2002}.}
  \label{Fig:non_lin_prop}
\end{figure} 

The distortion of the waveform generates high frequency components in the pulse frequency spectrum. These high frequency components appear at multiples of the fundamental frequency $f_0$, and are called harmonic frequencies (Figure \ref{Fig:harmonics}). As the wave propagates further the high frequencies are more attenuated, and the wave will eventually regain its shape with a reduced amplitude. 

\begin{figure}[h]
  \centering
  \includegraphics[width = \linewidth]{harmonics.png}
  \caption{Development of harmonic frequencies as the amplitude of the source is increased by 10, 20 and 26 dB from a near-linear situation. Measured at the focus of a \SI{3.5}{\mega\hertz} wave\cite{Uck2002}.}
  \label{Fig:harmonics}
\end{figure} 



\subsubsection{The bubble as a non-linear oscillator}
The non-linear response from a microbubble is in general not negligible. It is actually the property of interest, when used as contrast agents in diagnostic imaging, see Section \ref{sec:contrast_img}. A brief review of the non-linearity of bubble oscillations is given below. A full review is outside the scope of this thesis, and the interested reader is addressed to \citet{Hoff2000}. 

Compared to tissue, the non-linear response from microbubbles is large, and further increased by the coincidence of the resonance frequency being in the range of frequencies used in diagnostic imaging. The response from the contrast agent Optison\texttrademark  is shown in Figure \ref{Fig:bub_response}, where presence of harmonic peaks proves the non-linear behaviour of the microbubble. 

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{non_lin_bubble_response.png}
  \caption{Spectrum of scattered signal from an Optison\texttrademark microbubble, exposed to a signal with a fundamental frequency of \SI{2}{\mega\hertz}. The other peaks are due to the non-linear response of the bubble\cite{Shi1999}.}
  \label{Fig:bub_response}
\end{figure}
The non-linear dynamics of a spherical bubble in an infinite, incompressible fluid can be described by the Rayleigh-Plesset equation,
\begin{equation}
\label{r-p}
\frac{p_{R_0}\left(\frac{R_0}{R}\right)^{3\gamma}-p_0 - p(t)}{\rho_l} = \frac{3\dot{R}^2}{2}+R\ddot{R},
\end{equation}
where $R = R(t)$ is the bubble radius as a function of time, and $\dot{R}$ and $\ddot{R}$ the velocity and acceleration of the bubble wall, respectively. This is an ordinary differential equation which can be solved with initial conditions $R(0) = R_0$, and $\dot{R} = 0$\cite{Moss2014}. A derivation of the Rayleigh-Plesset equation is presented in Appendix \ref{App:R-P}.
%FIX beskrivelse a ligning!!!!.

 
%IINSERT FIGURES from ANDY???

\subsubsection{Contrast agents}
\label{contrast agents}
%SHell: Albumin, lipid, polymer, Nanoparticles??
%%%Ta med et avsnitt om forskjellige oscillasjoner til bobler. Kollaps, stabil osciallsjo, non-linear
%%Targeted microbubbles

Contrast agents are used to increase the image sensitivity and signal-to-noise ratio in medical imaging. In ultrasound imaging, this is accomplished by intravenous injection of a solution containing gas-filled microbubbles\cite{Paradossi2010}. Microdroplets are also used\cite{Soman2006}, but in much less extent than gas bubbles and is outside the scope of this thesis. Microbubbles are preferred because of the higher echogenicity\cite{Talu2008}.

The microbubbles have to fulfill several requirements to perform as a contrast agent. The contrast agent has to be delivered to the area of interest, and this set requirements to circulation time and size. The diameter has to be smaller than \SI{8}{\micro\metre} to pass the pulmonary capillary\cite{Tickner1980}, which is the size limiting factor in the circulatory system. Strong backscattering of ultrasound is important. Absorption is an unwanted effect as it attenuates the ultrasound wave without contributing to the received signal. It is also important that the contrast agent is well tolerated by the body and is able to leave the circulatory system either by dissolving or by being phagocytosed by the Kupfer cells in the liver\cite{Healey2012}.

The first contrast agents were made of saline, and was put to use by cardiologists in the 1960s\cite{Laboratories1997}. The saline was shaken before injection to create the microbubbles. Current available contrast agents have been able to fulfill the requirements stated, and consist of a gas enclosed in a suited shell. The shell has to be biocompatible and is made from fat, proteins or polymers. The advantage of a shell is increased lifetime and scattering of ultrasound. The size of the microbubbles is approximately smaller or equal to red blood cells, i.e. \SIrange{2}{6}{\micro\metre}(Figure \ref{Fig:Sonazoid}).

The gas filled microbubbles used as contrast agents are comparable to air bubbles in terms of density and compressibility, and from Figure \ref{Fig:rayleigh} we observe that the scattering cross section is completely dominated by the compressibility term. The ultrasound pressure fluctuations caused by the ultrasound, forces the microbubble to expand and contract in a non-linear fashion. The microbubble is in fact a chaotic oscillator, and the onset of the chaotic response is mainly determined by the thickness of the shell\cite{Macdonald2006}. The chaotic oscillation of the bubble wall of a free gas bubble is shown in Figure \ref{Fig:chaotic}. The onset energy is lower for a thinner shell. For common contrast agents the non-linearity is present at diagnostic frequencies.

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{chaotic bubble.png}
  \caption{Left: The relative radial response($\nicefrac{R(t)}{R_0}$) of a free gas bubble of \SI{4}{\micro\meter} diameter, subject to a pressure wave of \SI{2}{\mega\hertz} with driving pressure amplitude of 100, 250, 265, and \SI{320}{\kilo\pascal}, increasing from top to bottom. Right: The corresponding frequency spectrum\cite{Macdonald2006}.}
  \label{Fig:chaotic}
\end{figure}

The use of contrast agents has been limited to diagnostics, but these microbubbles possess properties suited to therapeutic use\cite{Kotopoulis2013}. The microbubbles can serve as drug carriers for ultrasound mediated drug delivery \cite{Dijkmans2004}, see Section \ref{sec:umdd}.

Sonazoid\texttrademark is a contrast agent which has overcome all requirements stated above, with a well characterized structure and size distribution (Figure \ref{Fig:Sonazoid}). There is a core of perfluorobutane gas, with a \SI{4}{\nano\meter} thick lipid monolayer shell with shear modulus and viscosity equal \SI{50(3)}{\mega\pascal} and \SI{0.8(1)}{\newton\second\per\meter\squared}, respectively\cite{Hoff2000}. The density of the perfluorobutane gas core is \SI{0.0098}{\gram\per\centi\meter\squared}, while the thermal diffusivity is \SI{0.07}{\centi\meter\squared\per\second}\cite{Healey2012}. The shell is a membrane of hydrogenated egg phosphatidyl serine (HEPS)\cite{Sontum2008}.

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{sonazoid.png}
  \caption{Left: The structure of Sonazoid\texttrademark , i.e. perfluorobutane gas encapsulated in a lipid monolayer. Right: Size distribution of Sonazoid\texttrademark and red blood cells\cite{Healey2012}.}
  \label{Fig:Sonazoid}
\end{figure}

\subsubsection{Contrast enhanced imaging}
\label{sec:contrast_img}
Due to the non-linear behaviour of the microbubbles in contrast agent, non-linear techniques are often applied to enhance the contrast-to-tissue signal ratio. Non-linear imaging techniques can differentiated by the applied mechanical index. The mechanical index (MI) is defined as $MI = \nicefrac{P_-}{f_c}$, where $P_-$ and $f_c$ is the peak negative pressure, and the pulse centre frequency, respectively. The MI describes the potential for mechanical effects due to acoustically driven microbubbles\cite{Flower2012}. For high-MI images the acoustic pressure is large enough to destroy most of the microbubbles in the imaging plane, releasing free gas bubbles and crating a short flash of high contrast. In low-MI images (MI \SIrange{0.05}{0.1}) few of the bubbles are disrupted and the non-linear scattering properties are used to form images. Different low-MI techniques are described below.

Low-MI techniques can be divided into two fundamentally different methods. The first method utilizes frequency filtering in the frequency-domain. This is applied in second harmonic imaging, where the transducer bandwidth covers both the fundamental transmit frequency, and the second harmonic (Figure \ref{Fig:Second harmonic}). Even at moderate pressure (\SIrange{0.1}{0.3}{\mega\pascal}) microbubbles generate harmonic frequencies, while the tissue response is mainly linear. The fundamental frequency is excluded from the recorded signal by a high-pass filter, and this increases the contrast-to-tissue ratio. The required bandwidth of the transducer gives limitations to the spatial resolution.

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{second_harmonic.png}
  \caption{The transducer used in second harmonic imaging. The bandwidth cover both the fundamental frequency $f_0$ and the second harmonic $2f_0$\cite{Hoskins2010}.}
  \label{Fig:Second harmonic}
\end{figure}

The second method enhance the non-linear response through scaling and subtraction of the received and transmitted pulses in the time-domain. Phase inversion is performed by emitting two pulses, where the second pulse is \ang{180} out of phase with the first pulse (Figure \ref{Fig:phase inversion}). When the two received signals are added, the linear part sum to zero because of the linear response to the applied pressure. The microbubbles are the principal source of the non-linear part in the image, and they are therefore emphasized by this technique.

Amplitude modulation is carried out by emitting two or three pulses with different amplitudes. The tissue will respond linearly to the amplitude, while the non-linear response from the microbubbles increase dramatically to the increased amplitude. The linear response can be removed by subtracting the received signals. A combination of the phase-inversion and the amplitude modulation is also possible. 

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{phase_inversion.png}
  \caption{The two signal pulses used in phase-inversion are \ang{180} out of phase. The non-linear signal is obtained from the sum of the two received signals\cite{Hoskins2010}.}
  \label{Fig:phase inversion}
\end{figure}

\subsubsection{Phase-shift bubbles}
The drug carrier used in this project is a two component particle composed of negatively charged gas microbubbles and positively charged emulsion droplets. This concept is called Acoustic cluster therapy (ACT\texttrademark) and is illustrated in Figure \ref{Fig:ACT}. Both the gas microbubble and the droplet have an initial size about \SIrange{2}{3}{\micro\metre}. The gas microbubble consist of a low solubility perfluorocarbon gas encapsulated in a negatively charged phospholipid membrane, e.g. Sonazoid\texttrademark. The drug is dissolved in a perfluorated oil phase, perfluoro-methylcyclopentane(pf-MCP), and stabilized by a positively charged phospholipid membrane. When the bubbles and droplets are mixed, clusters of droplets and bubbles will form due to electrostatic attractive forces.


\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{PS_compound.png}
  \caption{Illustration of phase-shift bubble, with the gas microbubble(left) and microdroplet(right).}
  \label{Fig:ACT}
\end{figure}


When the clusters are exposed to ultrasound of standard medical frequency (\SIrange{2}{15}{\mega\hertz}) and intensity\cite{Hoskins2010}, the microbubble will oscillate and transfer energy to the droplet through mechanical interactions at the boundary. This initiates a fusion into a gas and liquid mixture, encapsulated by a mixed surfactant membrane. The fluid will vaporize and expand to a gas bubble of approximately \SI{30}{\micro\metre}. The enlarged gas bubble can block the capillary network and maintain the local concentration of the released drug.  

If we assume rapid thermal conduction from surrounding blood, the partial pressure of the pf-MCP is close to the vapour pressure at body temperature. This vapour pressure is lower than the local hydrostatic pressure, and the difference is initially equalized by the gas from the microbubble. An inward diffusion of $\mathrm{O}_2$, $\mathrm{N}_2$, $\mathrm{CO}_2$, $\mathrm{H}_2\mathrm{O}$ and $\mathrm{Ar}$ will exist simultaneously, and these gases will also contribute to the equalization of the hydrostatic pressure. The inward diffusion is driven by partial pressure gradients of the respective gases. 

The evaporation will not occur if the blood is under-saturated of the previously mentioned gases. Excessive hydrostatic pressure inside the bubble will reduce the pressure gradient and may halt the evaporation. This may occur as a consequence of excessive surface tension or high hydrostatic pressure in the surrounding blood. The initial evaporation occurs in less than a millisecond. The inward diffusion may continue after the evaporation, until a maximum size is reached after approximately 20-30 seconds\cite{Healey_pc}.


%%No hard data exists for the ACT bubbles effects, except for the delivery experiments Annemieke has performed.  I would consider adding some simulations from Lars Hoff’s bubblesim programme.   I can help with this.
Application of low MI and low frequency (\SIrange{0.1}{2}{\mega\hertz}) ultrasound onto the phase-shift bubbles initiate oscillations and has shown to increase the drug accumulation in tissue\cite{wamel2014}. It is known that ultrasound can initiate microbubble oscillation and increase cell membrane permeability for macromolecules\cite{VanWamel2006a}. The same mechanisms may be activated by the oscillating phase-shift bubbles.

A more mathematical description of the evaporation is given below and follows the derivation from \citet{Healey2013}. We assume we can use the simplification of  ideal gases, i.e. we can use the ideal gas law
\begin{equation}
\label{ideal gas law}
 PV = nRT. 
\end{equation}  
Hence, the volume of evaporated gas, $v_{pf}$, is a function of the initial volume and pressure in the oil droplet, i.e.

\begin{equation}
\label{gas volume}
V_g(V_{pf}, p_{pf}) = \frac{n_{pf}RT}{p_{pf}}=\frac{V_{pf}\rho_{pf}RT}{M_{pf}p_{pf}}.
\end{equation}
We assume that the body temperature $T$ is \SI{310}{\kelvin}. 

Presumed that both the gas and liquid bubble are spherical, we have the simple relation between diameter and volume, $V = \frac{\pi d}{6}$. Using this and Equation \eqref{gas volume}, we get an expression for the diameter of the gas bubble, 

\begin{equation}
\label{diameter}
d_g(p_{pf}, d_{pf}) = d_{pf}\sqrt[3]{\frac{\rho_{pf}Rt}{M_{pf}p_{pf}}}.
\end{equation}
From this equation we can get the size of the gas bubble after the initial evaporation. For an initial diameter of \SI{4}{\micro\metre} we get a diameter about \SI{23.4}{\micro\metre}, knowing that the vapour pressure of pf-MCP at body temperature is \SI{76}{\kilo\pascal}\cite{Healey2013}.
To include surface tension we use the Young-Laplace equation for a sphere,
\begin{equation}
\label{Young-Laplace}
\Delta p = \gamma\frac{4}{d},
\end{equation}

to get an expression describing the pressure in the surrounding fluid, 

\begin{equation}
p_w = p_{partial} + p_{pf} - \gamma \frac{4}{d_g(p_{pf}\mathrm{, } d_{pf})}.
\end{equation}

Here $p_w$ is the total pressure in the surrounding fluid, while $p_{pf}$ is the partial pressure from the gases in the surrounding fluid. Combining equations above we get a cubic expression of the gas bubble diameter,  

\begin{equation}
\label{cubic}
(p_w-p_{partial})D_g^3 + 4\gamma D_g^2 - \frac{6v_{pf}\rho_{pf}RT}{\pi M_pf}.
\end{equation}

This equation has a real solution, and can be used to calculate an upper limit of the phase-shift gas bubble diameter. %This is shown in Figure ???.
%Insert figures.

%Dynamic calcultions 
In addition to the static description above, we can derive an expression for the dynamic bubble growth. The following is a simplified model.

There exists a mechanical equilibrium(pressure) at the bubble boundary, and from the ideal gas law (Equation \eqref{ideal gas law}) we have that

\begin{equation}
\label{mec eq}
p_A + p_{pf} = \frac{2\gamma}{r} + p_{atm}+p_{blood}, 
\end{equation}
where
\begin{equation}
p_A + P_{pf}= (C_A+C_{pf})RT.
\end{equation}

Using both Fick's first law of diffusion and that a change in mass has to cause a flux through the boundary ($J = -\od{n}{t}$), we have that

\begin{equation}
\label{flux}
J_{pf} = -\od{}{t}\left(\frac{4\pi C_{pf}r^3}{3}\right) = 4\pi r(c_{pf}(r)-c_{pf}(\infty)),
\end{equation}
and a similar expression for $J_A$. Note that the diffusion flux $J$ is given in mol per second. We can assume that the concentration of pf-MCP reduces to zero far from the bubble, i.e. $ c_{pf}(\infty)=0$. We get two differential equations, 
\begin{equation}
\label{diff1}
-\od{}{t}(C_{pf}r^3) = 3rD_{pf}L_{pf}C_{pf}, \mathrm{ and } -\od{}{t}(C_Ar^3)=3rD_AL_A\left(C_A-\frac{p_{air}}{RT}\right). 
\end{equation}
Here $L$ is the Concentration Ostwald coefficient describing the solubility of a gas, $L = \left(\frac{c}{C}\right)_{equilibrium}$\cite{Equilibria1984}. Lower-case $c_x$ is the concentration $x$ in the liquid phase, while upper-case $C_x$ is the concentration of $x$ in the vapour phase. Under saturation of air is incorporated in the term $\frac{p_{air}}{RT}$.

We rewrite these equations with dimensionless variables to get
\begin{equation}
F + A = \mu \rho^2+(1+\vartheta)\rho^3,\quad \od{F}{\Gamma}=-\frac{3L_{pf}}{\rho^2}F\quad \mathrm{ and }\quad \od{A}{\Gamma}=-\frac{3\delta L_A}{\rho^2}(A-p_d\rho^3),
\end{equation}
with the dimensionless variables
\begin{multline}
\label{dim}
\mu=\frac{2\gamma}{p_{atm}r_0}, \quad \vartheta = \frac{p_{blood}}{p_{atm}}, \quad \rho = \frac{r}{r_0}, \quad \chi_A =\frac{C_ART}{p_{atm}},\\
\chi_{pf} = \frac{C_{pf}RT}{p_{atm}}, \quad \Gamma = \frac{D_{pf}}{r_0^2}t, \quad A = \chi_A\rho^3, \quad F = \chi_{pf}\rho^3, \quad \mathrm{ and } \quad p_d = \frac{p_{air}}{p_{atm}}.
\end{multline}

Combining equations we get a differential equation for $\rho$, 
\begin{equation}
\label{diff3}
\od{\rho}{\Gamma} = \frac{-3\delta L_A(A-p_d\rho^3)- 3L_{pf}(\mu\rho^2+(1+\vartheta)\rho^3-A)}{\rho^3(2\mu+3(1+\vartheta)^rho)}.
\end{equation}

These three differential equations can be solved using appropriate initial conditions. Defining the variable $X_{pf}$ to be the initial mole fraction of pf-MCP, we get the initial conditions

\begin{equation}
F(0) = X_{pf}(\mu +\vartheta +1),\quad A(0)=(1-X_{pf})(\mu+\vartheta+1)\quad
\mathrm{and}\quad \rho(0)=1.
\end{equation}

The growth of the bubble radius and volume is calculated from these differential equations(Figure \ref{Fig:bubble growth}), with parameter values given in Table \ref{tab:growth parameters}.
\begin{figure}[h]
	\centering
	\includegraphics[width=\linewidth]{prostate cancer.png}
	\caption{Image of malignant prostate cancer(arrows)\cite{Halpern2006}. A: The tumor is seen as a hypoechoic area in B-mode. B: Harmonic imaging of contrast agent enhance the visibility of the tumor.}
	\label{Fig:bubble growth}
\end{figure}

\begin{table}[htb]
	\caption{Parameters used to calculate bubble diameter and volume of droplets with initial size 2 and 4 microns.}
	\label{tab:growth parameters}
	\begin{center}
		\begin{tabular}{@{}l l l @{}}\toprule
			& \multicolumn{2}{c}{Value} \\ \cmidrule(r){2-3}
			Parameter & Symbol & Value\\
			\midrule
			Preset & Contrast & Cardiac\\
			Transmit:\\
			Frequency & \SI{16}{\mega\hertz} & \SI{18}{\mega\hertz}\\
			Power & 3\% & 10\%\\
			Gate & & 6\\
			Beamwidth & & Standard
			Acquisition:\\
			Gain & 10 dB & 10 dB\\
			2D Gain & & 10 dB\\  
			Frame rate & 10 fps & 10 fps\\
			Depth & \SI{21.00}{\milli\meter} & \SI{21.00}{\milli\meter}\\
			Width & \SI{23.04}{\milli\meter} & \SI{23.04}{\milli\meter}\\
			Sensitivity & &1\\
			Line density & Standard & High \\ 
			Persistence & None & Off \\
			Display:\\
			Dynamic range &45 dB &40 dB \\
			Display Map & MB1 & MB2\\
			Brightness & 50 & 50\\
			Contrast & 50 & 50 \\
			\bottomrule
		\end{tabular}
	\end{center}
\end{table}

   
\subsubsection{Resolution and depth of view}
The ultrasound waves used in medical imaging are emitted as short pulses, where the pulse length determines the longitudinal resolution. It is impossible to distinguish two points in the longitudinal direction separated by a distance shorter than half the pulse length. A short pulse is therefore desirable in order to produce good longitudinal resolution. The theoretical minimum pulse length is one wavelength, although this is difficult to achieve in practice.A few wavelengths is a more realistic minimum. The width of the signal frequency band increase with decreasing pulse length. 

The required depth of view will depends on how deep the tissue of interest is located, but there will always be a finite required depth penetration. The attenuation of ultrasound is proportional to the frequency, so a good depth of view implies a low frequency. Hence, there will always be a trade off between good longitudinal resolution and depth of view, and the diagnostic frequency will be chosen according to the patient and application. 

All ultrasound images used in this research is imaged at frequencies of \SIrange{16}{18}{\mega\hertz} with a ultrasound apparatus suited small animals. The longitudinal resolution is about \SI{\sim 100}{\micro\meter}, significantly better than normal diagnostic images. These imaging frequencies are above the fundamental resonance frequency for standard contrast agents. Scattering from blood and tissue increases with frequency (Equation \eqref{rayleigh cross section}). The contrast-to-tissue ratio is therefore less. 

Lateral resolution is the minimum distance perpendicular to direction of propagation required to distinguish two objects. This is determined by the width of the beam, and may vary with the depth of view. It is common to focus the beam to obtain the best resolution at the depth of interest. Strong focusing will give very good resolution at a very limited depth range, while weak focusing give medium resolution through most of the image. Temporal resolution is determined by the frame rate, which is typically between 10 and 30 frames per second. 

Both the phase-shift and the Sonazoid\texttrademark microbubbles used in this research are smaller than the image resolution. This limits the performance of a counting algorithm as it is not possible to distinguish echoes from individual bubbles within a resolution cell. It may increase the echo amplitude, but separate intensity peaks will not appear in the image.


\subsubsection{Speckle}
Speckle is random, deterministic noise, giving ultrasound images the characteristic, granular appearance. Speckle is present in all coherent imaging, and is caused by interference of echoes originating from scatterers within the same resolution cell. These echoes can not be distinguished by the transducer. The received signal is proportional to the sum of the waveforms, which is determined by their relative phase. The shape and size of the speckle pattern is determined by the dimensions of the imaging system and the structure of the imaged tissue\cite{Szabo2013}.

Due to speckle, even smooth tissue look granular, and this reduce contrast resolution with an order of \num{\sim 7}. The contrast resolution is a measure of the level of contrast needed for an object to be visually identifiable within an image .The multiplicative nature of speckle, means that noise is proportional to the amplitude of the echo. This increases the difficulty of identifying single microbubbles, because similar intensity variations may be caused by the speckle pattern. 
%rettet 20.12
%Speckle is a random, deterministic speckle pattern present in all types of coherent imaging, thus also in ultrasound images. The speckle is formed by scatterers smaller than the resolution of the imaging system, and the shape and size of the speckle pattern is determined by the dimensions of the imaging system and the structure of the imaged tissue.
%
%The speckle is an interference phenomenon created by coherent waves with different phase and amplitude added together. If several echo waves arrive at the same piezoelectric element within a time span shorter than the emitted pulse, the piezoelectric element will not be able to distinguish the waves, and their impact will be added. 

\subsection{Tumor and ultrasound}
\subsubsection{Tumor structure}

 A tumor is a mass of tissue with abnormal growth, made up of malignant and non-malignant cells, lymph and blood vessels, and the extracellular matrix. A tumor can usually be characterized as benign or malignant, where a benign tumor is localized with a well-defined boundary and do usually not pose any health threat. A malignant tumor is what we know as cancer, and can invade adjacent tissue, perform metastasis and be life threatening\cite{king2006cancer}. 

A cancer starts off from one abnormal cell, which proliferates through cell division resulting in uncontrolled growth. To maintain growth beyond a critical size of about \SI{1}{\milli\metre}\cite{king2006cancer}, new blood vessels are induced through angiogenesis to meet the need of nutrients and oxygen. 

The invasion of adjacent, normal tissue distinguish the malignant tumor from the benign, and this happens along  the pathways of least resistance, i.e. along vessels or fascia. This invasion is enhanced by increased amount of proteases outside the tumor boundary, which increases mobility of the cancerous cells. This also enhance the metastasis, where the cancer is spread along blood and lymphatic vessels and the peritoneal or pleural cavity to a new site\cite{king2006cancer}.
 
An important feature which permits localized drug delivery, is the structure of the cancer vasculature. This vasculature is developed through the angiogenesis, which is enhanced by Vascular endothelial growth factors(VEGFs). The VEGFs diffuse through the extracellular matrix(ECM) and connect to receptors on the inner surface of the vessel walls (Endothelial cells)\cite{Koumoutsakos2013}. This stimulates both the production of more endothelial cells and the construction of new vessels through the extracellular matrix\cite{Nishida2006}. This results in a structure which differ from normal vasculature. The tumor vasculature has increased vessel density and vessel size, a large amount of dead-ends and a disordered branching pattern.    

The abnormal amount of endothelial cells leads to vascular walls which lack in coverage of perivascular cells and tight adherens junctions which usually stabilize the vessel. Hence, there will be large intracellular spaces in the vessel wall, and the vessels become leaky. This allow the cancer cells to enter the vasculature and enhance macromolecular transport through the vessel wall. Tumors also tend to have a reduced or impaired lymphatic system. This reduce the capability of draining extravasated fluid and macromolecules. This is known as the \textit{enhanced permeability and retention}(EPR) effect\cite{Matsumura1986}. The EPR effect enhance local delivery of cancer drugs.



\subsubsection{Tumor imaging}
Imaging of tumors is important in diagnosis and early detection of cancer as it allows for non-invasive differentiation of benign and malignant tissue. It is possible to use B-mode images to distinguish on behalf of shape and texture, but these properties varies between different types of cancer. For prostate cancer about half of the tumors could be identified in a B-mode image due to reduced echotexture and an oblong shape\cite{Halpern2006}. 

More advanced imaging such as Doppler or contrast enhanced imaging can image the tumor blood flow, and make it possible to distinguish benign and malignant tumor from the blood flow pattern. For thyroid cancer, benign tumors have a hilar flow pattern, while malignant tumors have a peripheral pattern with short branches\cite{Go2003}. Malignant tumors have also higher microvessel density, and it is shown a clear correlation between microvessel density and metastasis\cite{Rifkin1990}. Contrast agent microbubbles provide the possibility of visualizing microvessels with diameter less than the resolution of the imaging system. In Figure \ref{Fig:prostate cancer}, prostate cancer is imaged using B-mode(A) and harmonic non-linear mode(B).

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{prostate cancer.png}
  \caption{Image of malignant prostate cancer(arrows)\cite{Halpern2006}. A: The tumor is seen as a hypoechoic area in B-mode. B: Harmonic imaging of contrast agent enhance the visibility of the tumor.}
  \label{Fig:prostate cancer}
\end{figure}

The extracellular matrix found in tumors is unusually stiff, and the solid stress applied to the vasculature may  squeeze blood vessels. This prevents drug delivery and can cause hypoxia within tumor regions. Hypoxia does not lead to cell death, but increases the production of proteins which prevents tumor-fighting immune cells\cite{Jain2014}. By imaging the tumor vasculature using contrast agents, it is possible to visualize these oxygen depleted areas. This might be useful predicting the outcome of cancer treatment. 
%the following section is maybe irrelevant
%\subsection{Cancer}
%The cell growth is regulated by two types of genes. Proto-oncogenes regulate normal cell proliferation, while the tumor suppressor genes control repair of cell damage, cell death and growth inhibition. Mutation or loss of any of these regulatory systems can cause cancer growth. 


\subsubsection{Cancer treatment}

Despite the massive amount of research, new drug development, genetic tumor characterization, improved radiotherpapy and surgery, many young people die from cancer every year. Recent research by \citet{Tomasetti2014} has revealed that most cancers are all about luck. Still, certain cancer types are strongly related to inherited predispositions or  lifestyle, such as smoking and exposure to sunlight, and prevention is therefore an important action in the battle against cancer.  

Screening is another action which involves examination of people without symptoms, and may reveal cancer in an early stage.  Early detection has shown to be decisive for the outcome of the cancer treatment\cite{king2006cancer}\cite{Jordan1986}. For high risk groups and certain cancers,  screening is applicable and usefull, but the benefit of general mass screening is still debated. 

The main available cancer treatments are surgery, radiotherapy and chemotherapy, and they are often combined to achieve the best result. Cancer treatment is not necessarily curative, but may be palliative; i.e. reduce symptoms and prolong lifetime. Regardless of method, a treatment is successful if all cancerous cell are corrupted. This should be accomplished with the least possible damage to healthy tissue. Different treatments may perform best, depending on type, location and the stage of the cancer.Surgery and radiotherapy are outside the scope of this thesis.

Chemotherapy use cytotoxic or cytostatic drugs to kill malignant cells or prevent further growth\cite{Skeel2011}. Chemotherapy is a systemic treatment, and the drugs are distributed through the circulatory system. The benefit of a systemic treatments is that it targets both potential metastasis as well as primary tumors. The drawback is that only a small fraction of the dose reach malignant cells. The rest of the dose cause dangerous side effects to healthy tissue\cite{doi:10.1056/NEJM200106283442607}. These side effects limit the dose to a low level. This is described by a therapeutic index close to one. The therapeutic index is the ratio of a lethal dose and the minimum dose required for a therapeutic effect.
 
\subsubsection{Localized drug delivery}
Increased targeting of the chemotherapeutic drugs enables the delivery of more drug to the malignant cells without an increase in the total dose. The increased leakiness of the tumor vasculature, the over-expression of specific receptors and impaired lymphatic system are three characteristic properties of tumor tissue which permits localized delivery. Recent research has enabled drug carriers on nanoscale which utilize these possibilities\cite{Jafari}. The research in this field can be divided into passive, active and triggered targeting. Note that localized drug delivery does not treat potential metastasis, but can be administrated simultaneously as normal chemotherapeutics to achieve a combined effect of systemic treatment and increased local delivery.

Passive targeting relies on the accumulation of drug in cancerous tissue due to the EPR effect. The drug is loaded into drug carriers which are only able to penetrate the endothelial layer if the EPR effect is present\cite{Andresen2010}. The carriers are designed to remain in the circulatory system for a long time to provide sufficient accumulation in the tumor. These carriers are of a size \SIrange{10}{500}{\nano\meter}, although the lower cut off size varies\cite{Hofmann}. This targeting is limited by the vascularity and leakiness of the tumor. The increased hydrostatic pressure present in tumors can also reduce the accumulation\cite{Bae2009}.  

Active targeting is conducted by drug carriers with a surface designed to stick to overexpressed receptors in the tumor vasculature or tissue. Triggered targeting utilize drug loaded particles which are activated inside the tumor causing immediate drug release. Tumors may have different pH or enzymes than normal tissue,  and these changes can trigger release. The drug release can also be activated by an external energy, such as heat, magnetic resonance, ultrasound or light\cite{Jafari}. Ultrasound mediated drug delivery is addressed below. 
	
\subsubsection{Ultrasound mediated drug delivery}
\label{sec:umdd}
Ultrasound is an attractive trigger for targeted drug delivery as it is non-invasive, generally safe and well characterized. It is proved that ultrasound increase the cell membrane permeability, in particular if microbubbles are present\cite{VanWamel2006a}. This is known as sonoporation and does mainly affect adjacent cells. Ultrasound can also increase the range of the drug after leaving the vasculature\cite{Eggen2013}.

There are several mechanisms that can explain the increased drug transport, although their relative importance is unknown. One phenomenon is called microstraming and is caused by stable microbubble oscillation. This induces circulating eddies around the microbubble, which increases the fluid velocity and shear forces\cite{Nyborg1982}. This may disrupt cell membranes\cite{Marmottant2003}. A second mechanism is that the oscillations move the cell membrane and create hydrophilic pores (Figure \ref{Fig:oscillating_bubble})\cite{VanWamel2006a}.

Ultrasound can also be utilized to collapse microbubbles. This can release drugs attached to the microbubbles surface, and the collapse can cause a shockwave capable of damaging surrounding tissue and increase drug transportation. If the microbubble is adjacent to a large cell membrane, this may induce an asymmetric collapse and a jet of fluid. This may rupture the cell membrane \cite{Pitt2004}.  

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{oscillating_bubble.png}
  \caption{The oscillation moves the cell membrane and create hydrophilic pores which enables transport of fluid or macromulecules through the membrane\cite{VanWamel2006a}.}
  \label{Fig:oscillating_bubble}
\end{figure}


The aforementioned mechanisms have been utilized \textit{in vivo} to enhance drug delivery. Small amounts of hydrophilic drug can be attached to the surface of the microbubble, or hydrophobic drug can be incorporated into the shell of the microbubble. The drug is then released as the microbubbles are disrupted by an ultrasound pulse\cite{Liu2006}. Drugs have also been loaded into liposomes and administered together with microbubbles, but the effect is then very dependent on the simultaneous localization of the liposome and microbubble in the tumor vasculature. To ensure the co-localization the microbubble and the drug can be encapsulated together within a liposome membrane shell\cite{Ibsen2011}.

%Another strategy is the use of nanoparticles made from ......

%This effect can be utilized on drug loaded microbubbles to increase uptake. This is shown \textit{in vivo} for the drug liposomal doxorubicin in prostate cancer xenografts in mice\cite{Eggen2013}.
  


\subsection{Existing algorithms for image processing and counting}
\label{existing algorithms}
Identification and counting of stuck phase-shift bubbles is the core problem tackled in this work. The problem is divided in three main subjects. The first part is image registration, utilized to remove motion artefacts, which is of great importance for the robustness. It is difficult to identify stuck objects if their position in the image changes from frame to frame.

The second subject involves enhancing the contrast agent. Contrast agent provides positive contrast into the image. A simplified description is that the image is a sum of the background signal (i.e. signal from tissue without contrast agent present) and the signal provided by the contrast agent. To extract the contribution from the contrast agent, the obvious solution is to subtract the background. Another common solution is to apply a bubble specific imaging mode which suppress tissue and enhance microbubbles. This solution is more applicable to normal diagnostic imaging, where the tissue non-linear response is minimal. Frequencies from \SIrange{16}{18}{\mega\hertz} are applied in this research, and the tissue non-linear response is present. Sonazoid\texttrademark microbubbles can be imaged in non-linear contrast mode, but the tissue signal is visible (Figure \ref{Fig:Sonazoid non-lin}). The response from Sonazoid\texttrademark microbubbles to \SI{16}{\mega\hertz} is shown in Figure \ref{Fig:sonazoid_non_lin_response}.

The phase-shift bubbles respond fundamentally different from the Sonazoid\texttrademark microbubbles, due too different size (Figure \ref{Fig:PS_non_lin_response}). Comparing the two simulations, we find that the non-linear response is much less for the ACT\texttrademark bubbles. The amplitude is \SI{\sim20}{\decibel} larger for the ACT\texttrademark bubbles. This makes them more suited for B-mode imaging, and background subtraction to segment the phase-shift bubble signal.
\begin{figure}
	\centering
	\begin{subfigure}[b]{0.55\textwidth}
		\includegraphics[width=1\linewidth]{non_lin_sonazoid_before.png}
		\caption{}
		\label{fig:Ng1} 
	\end{subfigure}
	
	\begin{subfigure}[b]{0.55\textwidth}
		\includegraphics[width=1\linewidth]{non_lin_sonazoid.png}
		\caption{}
		\label{fig:Ng2}
	\end{subfigure}
	\caption{Non-linear contrast mode image with Vevo 2100 of tumor tissue before(a) and after(b) introduction of Sonazoid\texttrademark.}
	\label{Fig:Sonazoid non-lin}
\end{figure}

\begin{figure}
	\includegraphics[width=\linewidth]{sonazoid_non_lin_response.png}
	\caption{Simulation of 2 microns bubble with Sonazoid\texttrademark shell parameters response to two \num{2.5} wavelengths ultrasound pulse,  \SI{16}{\mega\hertz}, MI = \num{2.4}. The two waves(blue and red) are \ang{180} out of phase. The black stapled line illustrates the linear response. In the upper left image the transmitted waves are plotted, while the received waveforms are found in the upper right. In the lower left image the bubble radius is plotted. The lower right image shows the frequency spectra.} 
	\label{Fig:sonazoid_non_lin_response}
\end{figure}
\begin{figure}
	\includegraphics[width=\linewidth]{phase_shift_bubbles_non_lin_response.png}
	\caption{Simulation of 30 microns bubble with ACT\texttrademark parameters response to two \num{2.5} wavelengths ultrasound pulse,  \SI{16}{\mega\hertz}, MI = \num{2.4}. The two waves(blue and red) are \ang{180} out of phase. The black stapled line illustrates the linear response. In the upper left image the transmitted waves are plotted, while the received waveforms are found in the upper right. In the lower left image the bubble radius is plotted. The lower right image shows the frequency spectra.} 
	\label{Fig:PS_non_lin_response}
\end{figure}

When imaging deposition and accumulation of ACT\texttrademark bubbles, the signal has two components - signal from free flowing (or possibly stuck) Sonazoid\texttrademark and deposited ACT\texttrademark bubbles. The problem is essentially to differentiate the stuck ACT\texttrademark from the free flowing Sonazoid\texttrademark. This is accomplished by using the relatively greater signal in B-mode, and the stationary nature of the ACT\texttrademark bubbles. Image areas where phase-shift bubbles are present should have a consistency in image intensity. A consistency check can be applied using the fact that Sonazoid\texttrademark bubbles are destroyed by high power ultrasound, while ACT\texttrademark bubbles are not. 

A few algorithms that handle quantification of stationary bubbles are published. In the work by \citet{Rychak2006} the free bubbles were distinguished from the stuck bubbles by simply waiting for the circulating microbubbles to clear. The microbubbles are taken up in the liver or lungs, although this may take several minutes. The stuck microbubbles can then be segmented from the tissue signal by either using non-linear imaging, or by destroying the microbubbles with a high power ultrasound pulse. The signal left, can be subtracted from the prior signal to get the signal caused by microbubbles.

Two other methods are described by \citet{Zhao2007}. The first method utilizes a image-push-image sequence, where they first take one image before ultrasound radiation force is used to promote adhesion of the microbubbles. A second image is captured, and the the first image is subtracted to segment the contrast agent. The second method utilizes harmonic imaging and a high-pass filter to differentiate tissue and contrast agent. For both methods the signal from free flowing microbubbles is removed by low-pass interframe filtering. A low-pass filtering is also applied by \citet{Needles2009} to distinguish free and stuck microbubbles. Here, subharmonic imaging is used to segment microbubbles from the tissue. This method is successfully applied \textit{in vitro}.  
   
\subsection{Image processing}
\subsubsection{Transducer}
A transducer has the capability to transform applied electrical signals to pressure waves and vice versa. It is therefore responsible for both emitting ultrasound pulses and receiving echoes in an ultrasound apparatus. A good transducer performs this task with high conversion efficiency and without introduction of noise. 

The key element of the transducer is the piezoelectric element, which is a shaped piece of either a piezoelectric ceramic (lead zirconate titanate, PZT) or plastic (polyvinylidine difluoride, PVDF) coated with silver electrodes on the front- and backside. A voltage across the electrodes corresponds to a proportional change of the thickness of the piezoelectric element.

The speed of sound, $c$, in a piezoelectric element is approximately \SI{4000}{\metre\per\second}. The fundamental resonance is at $\nicefrac{\lambda}{2}$, so the thickness, $T$, is given by the choice of the frequency $f$, i.e.
\begin{equation}
\label{thickness}
T = \frac{\lambda}{2}= \frac{c}{2f} = \frac{2}{f(\mathrm{Mhz})}.
\end{equation}  

Hence, the frequency range of a transducer is limited to a band around the fundamental resonance, and is determined by the thickness of the piezoelectric element. 

The front of the piezoelectric element is covered by a matching layer which increases the efficiency by reducing the difference in acoustic impedance between the element and the tissue. The back is covered by a backing medium which give mechanical support and provide mechanical damping. 

Modern transducers usually have an array of piezoelectric elements. The advantage is the possibility of beam steering, translation and focusing, and enables parallel processing which can reduce acquisition time, speckle and signal-to-noise ratio(SNR)\cite{Flower2012}.
   
\subsubsection{Digitalization, amplification and time-gain compensation}
After the echoes have reached the transducer a signal is produced by making an image with the brightness at each pixel determined by the strength of the echo from the corresponding distance and direction. The first step in the image processing is to convert from analogue to digital signal. The digital signal is less vulnerable to noise and distortion, and it enables further digital image processing. Then a linear amplifier applies the same amount of gain to the entire signal, to make the signal strong enough for further processing. Time-gain compensation is then applied to equalize echoes from similar interfaces, regardless of the depth of their origin. This is performed by increasing the gain with increasing depth of echo. The depth of the echo is identified by the arrival time at the transducer. The rate of attenuation of ultrasound with depth is determined by the frequency and tissue.

After amplification and time-gain compensation the dynamic range of the signal is about 60 dB. The dynamic range of a signal is defined as the ratio between the largest amplitude that can be recorded without causing distortion and the lowest amplitude that can be distinguished from noise. The dynamic range of a common screen is about 20 dB. The signal must therefore be compressed before it can be displayed. To compress the dynamic range from 60 to 20 dB, an amplifier with non-linear gain is applied. Low amplitudes are amplified more than high, and the dynamic range is therefore decreased. Compression allows weak echoes from scattering within tissue to be displayed together with strong echoes from tissue interfaces.

\subsubsection{Radiofrequency and In Quadrature data}
Radiofrequency (RF) is a term used in ultrasound to describe unprocessed data. In Quadrature (IQ) refers to a demodulation of the RF signal, utilized to reduce the amount of storage space without loss of information. IQ modulation converts the signal from the real to the imaginary space. The IQ signal is obtained using a IQ-demodulator to down-mix, low-pass filter and decimate the RF signal. The IQ signal can be computed through a Hilbert transform\cite{Kirkhorn1999}.

\subsubsection{Hilbert transform}
The Hilbert transform is a linear operator that acts on a signal $u(t)$ to derive an analytic signal. The Hilbert transform converts the signal from real to complex space by adding or subtracting 90 degrees. It is used to obtain an analytic signal, that has by definition only positive frequencies in the Fourier transform. The analytic signal $\tilde{x}(t)$ can be written as
%It is therefore also known as a phase-shift operator. An analytic signal has by definition only positive frequencies in its Fourier transform, and is related to the Hilbert transform through 

\begin{equation}
\tilde{x}(t) = x(t) + x_h(t),
\end{equation}

where $x(t)$ is the signal and $x_h(t)$ its Hilbert transform. The Hilbert transform can be written as a convolution, 

\begin{equation}
x_h(t) = \frac{1}{\pi}p.v.\int_{-\infty}^{\infty}\frac{x(\tau)}{t-\tau}\dif \tau  = x(t)*\frac{1}{\pi t},
\end{equation}
where p.v. is the Cauchy principle value of the integral required to accommodate for the divergence at $t=\tau$. The associated analytic signal may be defined for any signal for which a Fourier Transform exists. It follows that $x_h(t)$ is the output of a system with impulse response $h(t)=\frac{1}{\pi t}$, with $H(\omega)=-i \sgn(\omega)$  and input function $x(t)$.  The system changes the phase of the positive Fourier components by \ang{-90}, and negative Fourier components by \ang{90} and is known as the quadrature filter.  
%
%which can be interpreted as a filtering operation with a quadrature filter which shifts all sinusoidal components by a phase shift of $\frac{\pi}{2}$. The envelope is the amplitude of the analytic signal, and a B-mode image is created from the envelope of the signal. 

\subsubsection{Downsampling}
The envelope is used to create the B-mode images, therefore further reduction in data size can be achieved by downsampling of the RF signal. The RF signal is downsampled by a decimation factor $M$, by only recording every $M$th sample. 

The RF signal is strictly bandlimited by the bandwidth of the transducer. The envelope is thus also a bandlimited signal, with a finite maximum frequency. According to the Nyquist-Shannon sampling theorem, this signal can be sampled without aliasing or loss of information by a sampling rate twice the maximum frequency. Hence, the decimation factor, $M$, is determined so that

\begin{equation}
\label{deciamtion}
\frac{Fs_{RF}}{M} > 2f^{max}_{envelope},
\end{equation}

where $Fs_{RF}$ is the sampling frequency of the RF signal, and $f^{max}_{envelope}$ is the maximum frequency of the envelope. A thorough explanation is given in by \citet{Crochiere1981}.


\subsubsection{Image registration}
Image registration is the process where one image is spatially aligned to a reference image. The image to be aligned is called the moving image, while the reference image is called the fixed image. Image registration  is an important part of image processing and can both be used to remove motion artefacts and to fuse images of the same object, captured with different image modalities or from different directions. 

Image registration is initially divided into extrinsic and intrinsic methods. Extrinsic methods are based on foreign objects placed into the scene before the image is captured. This has the advantage of simple, feature-based registration, but the preplacement and removal of these objects may not be trivial. 

Intrinsic methods can be divided into feature and intensity based registration. Features can either be easily recognizable points identified by the user, or structures which can be extracted from the image by image segmentation. These methods are mostly used in rigid transformations, and have the advantage of being simple computations once the features are determined. One drawback is that the registration often is limited by the reliability of the segmentation or identification of the features. Although these methods are applicable to both multi- and monomodal registration, and to different body parts, in general their use has been limited to neuroimaging and orthopedic imaging\cite{Maintz1998}.

Intensity based registration differs from the other methods by using the intensity pixel values directly to compare the fixed and moving image. To compare the images a suited similarity measure is used, see Section \ref{subsec:similarity}. Using different similarity measures, this method is suitable for both multi- and monomodal registration. The image registration is then performed using an optimization scheme to find the spatial translation of the moving image which minimizes the chosen similarity measure. Choosing the right similarity measure and optimization scheme is essential to get a satisfying result. For a full review of this topic, the reader directed to the survey written by \citet{Maintz1998}.

%\subsubsection{Basic theory of image registration}
%\cite{Mainstream}
%%Should non-parametric transformations be mentioned?
%
%%Transformation of an image is the basis for image registration, and can be described as a function $y$ mapping the image coordinates from $\Real_d \arrow \Real_d$ using a linear combination of basis functions and coefficients.

\subsubsection{Image transformation}

Transformation of an image is the basis for image registration, and can be described as a mapping of a coordinate vector $\vec{x}$ from the space $X$ to a new coordinate vector $\vec{y}$ in the space $Y$. The transformation is performed by a transformation matrix $A$, i.e. $\vec{y} = A\vec{x}$.

In 2D a rigid transformation can be written as 

\begin{equation}
	\label{rigid}
	\begin{pmatrix}
		y_1 \\
		y_2 \\
		1 
	\end{pmatrix}
	=
	\begin{pmatrix}
		R_{11} & R_{12} & T_1\\
		R_{21} & R_{22} & T_2\\		
		0 & 0 & 1
	\end{pmatrix}
	\begin{pmatrix}
		x_1\\
		x_2\\
		1
	\end{pmatrix},
\end{equation}
where $R_{ij}$ are elements in the rotation matrix 

\begin{equation}
	R = 
	\begin{pmatrix}
	\cos \theta & -\sin \theta\\
	\sin \theta & \cos \theta
	\end{pmatrix}.
\end{equation}
The rotation matrix rotates the coordinates an angle $\theta$ around the origo. The matrix elements $T_{ij}$ determines the translation of the coordinates. A general affine translation is described by the matrix

\begin{equation}
\begin{pmatrix}
 a_{11}&a_{12}&a_{13}\\
 a_{21}&a_{22}&a_{23}\\
 0&0&1\\
 
\end{pmatrix}
\end{equation} 
This enables shear and scaling of the image.

If we apply a transformation matrix to an image, we get the new pixel coordinates of the transformed image, but these points will not be on the grid coordinates of the image. For that reason, an interpolation scheme is applied to the transformed image coordinates to get the new pixel values at the grid coordinates. A suitable interpolation scheme must be chosen to meet the needs of the given problem.

Image transformation can be divided into linear and non-linear transformation. For a linear transformation the same transformation matrix is applied to the whole image, whereas this is not the case for a non-linear transformation. Linear transformation is computationally faster and simpler, and less affected by noise. On the other hand, non-linear transformations can correct for local deformations outside the reach of a linear transformation. 

The difficult part of image registration is not to apply the transformation, but to obtain the right transformation matrix. The simplest case is the point or feature based method, where easily recognized features are localized in both the fixed and moving image. The is accomplished either by interaction from the user, or by using a feature detection algorithm. In the case of an affine transformation, six pair of corresponding coordinates are needed to solve the set of linear equations to obtain the six unknown elements in the transformation matrix. Usually, more points are obtained, and the transformation matrix is calculated using a least-squares approach. 

\subsubsection{Similarity measures}
\label{subsec:similarity}
There are several ways of measuring the similarity between two images. Different approaches enhance different image properties, and are suit different problems. The choice of similarity measure will determine the minimum and the rate of convergence for the optimization scheme.

When the images to be compared are in the same modality, they are in the same intensity range. They only differ because of noise, geometric transformation and changes in the imaged object. Common similarity measures are then the sum of squared differences (SSD), the sum of absolute differences or the cross correlation. If the changes in the imaged object is sufficiently small, and we assume the noise to be Gaussian, it is shown that SSD give the optimal result \cite{Viola1997}. For two images $A$ and $B$ the SSD is given as
\begin{equation}
\label{SSD}
\mathrm{SSD} = \sum_{i}^N \abs{A_i -B_i}^2, \forall i \in A \cap B,   
\end{equation}

where $i$ is an image pixel. A closely related similarity measure is the Mean square error, $MSE = \nicefrac{SSD}{N}$.

In multimodal image registration, the images have neither similar intensities or even a linear relationship between the intensities. For this type of problems, mutual information is the most common similarity measure. Mutual information is a measure of the statistical dependence of the two images. The alignment is optimal if the moving image contains the maximal amount of information about the fixed image. A detailed review of mutual information in medical multimodal imaging is conducted by \citet{563664}.  

\subsubsection{Regular step gradient descent}
An optimization scheme determines the optimal alignment by optimizing the chosen similarity measure. The optimization scheme is usually chosen through an empirical approach, where computational demand, reliability and stability are important factors. 

The gradient descent method is a first-order algorithm which finds the local minimum of a multivariable, differentiable function $F(x)$. From a given initial state $x_k$, the optimizer moves a distance $\gamma$ in the direction opposite to the gradient, i.e.

\begin{equation}
\label{gradient descent}
x_{k+1} = x_k - \gamma \Delta F(x_k).
\end{equation}

This method suffers from the reliability of the step distance $\gamma$. A step, too long or too short, result in slow, or no convergence. The \textit{regular step gradient descent} is a variation where the step length is halved every time there is a significant change in the direction of the gradient. The optimization terminates after reaching a minimum, at a minimum step length, or after a maximum number of iterations.

To speed up the image registration, a pyramidal method can be applied together with the gradient descent. A smoothing filter is applied to the images, before they are decimated by a factor of two. This is performed for a given number of pyramid levels, resulting in a set of images with decreasing size. This scheme starts by optimizing the translation of the smallest image, and this optimal translation is used as an initially in the next pyramid level. In addition to increased speed, there is less chance of getting stuck in a local minimum due to the smoothing applied before each decimation.
 
\subsubsection{Interpolation}
Interpolation is a mathematical method for resampling of data points. Several different methods are common, all with a trade-off between performance and computational effort. For image interpolation, nearest neighbour, bilinear and bicubic approaches are the most common methods. Nearest neighbour assign a value to the new data point equal the value of the nearest existing data point. The assigned value in bilinear interpolation is a linearly weighted sum of the nearest existing data points with respect to the distance to the new data point. 

For bicubic interpolation a piecewise, cubic polynomial is calculated from the existing data to estimate the value at the new data point. A smooth fit is achieved by requiring the function, and its 1. and 2. derivatives to be continuous at every boundary. This scheme is slower than nearest neighbour and bilinear, but the result is usually improved.  

\subsubsection{Background subtraction}
Background subtraction is a method for visualizing the contrast agent in the ultrasound images. A background image is created from a set of images recorded before the presence of the contrast agent. The background is constructed by taking the maximum value of the chosen set at each pixel. The contrast agent can then be segmented from the image by subtracting the background image. 

To ensure sufficient subtraction, the background can be filtered before subtraction with a maximum filter. A maximum filter is a morphological, non-linear filter that considers the neighbourhood around the given pixel. The assigned value is equal to the maximum value of the neighbours, and the size of the neighbourhood is given by the size of the filter. In other words

\begin{equation}
B_{ij} = max(A_{kl})\ \forall A_{kl} \in N,
\end{equation}
where $N$ is the neighbourhood of $A_{ij}$, where $A$ and $B$ is the original and filtered image, respectively. 

This filter is applied to achieve a more robust background. By applying this filter we create a background of increased intensities, that can compensate for some of the natural variations and noise in the tissue signal. The microbubbles add positive signal. By subtracting the filtered background we make a conservative estimate of the contrast signal. 

%\subsubsection{Counting of phase-shift bubbles}
%Counting of individual bubbles in ultrasound images is a field of image processing with limited available literature and publications. One approach is described in \cite{Needles2009}, where microbubbles bound to vessel walls are differentiated from tissue and flowing microbubbles. Subharmonic imaging is used to separate tissue and microbubbles, before a low-pass inter-frame filter is applied to remove the free flowing microbubbles.

%\subsubsection{Temproral coherence filter}
%Temporal coherence is a measure of the correlation between the value of a pixel and the value of the same pixel at a later time. 
%F
%
%
%










